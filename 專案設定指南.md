# XMC4800 CANopen 專案設定指南

## 🎯 已完成的環境配置

### ✅ VS Code 配置檔案
- `.vscode/settings.json` - C/C++ 編譯器和 IntelliSense 配置
- `.vscode/tasks.json` - DAVE IDE 建置任務
- `.vscode/launch.json` - J-Link 調試配置
- `.vscode/extensions.json` - 推薦的擴展套件

### ✅ 專案檔案結構
```
c:\prj\AI\CANOpen\
├── .vscode/                    # VS Code 配置
├── src/                        # 主要原始碼
│   └── main.c                 # 主程式 (已建立範本)
├── scripts/                    # 輔助腳本
│   └── flash.jlink            # J-Link 燒錄腳本
├── docs/                      # 文件目錄
│   ├── 執行方針文件.md
│   ├── 系統架構規劃文件.md
│   ├── AI協助提示文件.md
│   └── VS Code開發環境配置.md
└── README.md                  # 專案說明
```

## 🚀 下一步執行項目

### 1. 立即需要執行 (高優先級)

#### 1.1 建立 DAVE IDE 專案
```bash
# 開啟 DAVE IDE
C:\Infineon\Tools\DAVE IDE\4.5.0.202105191637\eclipse\eclipse.exe

# 建立新專案步驟：
1. File → New → DAVE Project
2. 選擇: XMC4800-E196x2048
3. 專案名稱: XMC4800_CANopen
4. 位置: c:\prj\AI\CANOpen\Dave\
```

#### 1.2 配置 DAVE Apps
需要新增的 DAVE Apps：
- **CLOCK_XMC4** - 系統時鐘 (120MHz)
- **CPU_CTRL_XMC4** - CPU 控制
- **CAN_NODE** - CAN 節點配置
- **DIGITAL_IO** - LED 控制
- **UART** - 除錯輸出
- **SYSTIMER** - 系統定時器

#### 1.3 下載 CANopenNode 2.0
```bash
# 在專案根目錄執行
cd c:\prj\AI\CANOpen
git init
git submodule add https://github.com/CANopenNode/CANopenNode.git
git submodule update --init --recursive
```

### 2. 開發階段任務

#### 階段 1: CAN 驅動開發 (3-5 天)
- [ ] 建立 `src/can_driver/` 目錄
- [ ] 實現 `can_xmc4800.c` - XMC4800 CAN 驅動
- [ ] 實現 `can_xmc4800.h` - CAN 驅動標頭檔
- [ ] 參考 CanOpenSTM32 專案進行移植
- [ ] 測試基礎 CAN 收發功能

#### 階段 2: CANopen 整合 (5-7 天)
- [ ] 建立 `src/canopen/` 目錄
- [ ] 實現物件字典 `CO_OD.c/h`
- [ ] 實現驅動層適配 `CO_driver_target.h`
- [ ] 整合 CANopenNode 函式庫
- [ ] 測試 NMT 狀態機

#### 階段 3: 應用層開發 (3-5 天)
- [ ] 建立 `src/application/` 目錄
- [ ] 實現應用程式邏輯
- [ ] 實現設備描述檔
- [ ] 實現診斷功能

## 🔧 重要配置說明

### CAN 硬體配置
```c
/* XMC4800 CAN 腳位配置 */
CAN0_TXD: P1.13 (AF9 - Alternative Function 9)
CAN0_RXD: P1.12 (Input)

/* CAN 參數配置 */
節點: CAN_NODE_0
位元速率: 500 kbps
取樣點: 87.5%
SJW: 1
```

### LED 狀態指示
```c
/* LED 腳位配置 */
LED_GREEN: P1.1  // 系統運行狀態
LED_RED:   P1.0  // 錯誤狀態指示

/* 狀態說明 */
綠燈恆亮: Operational 狀態
綠燈閃爍: Pre-operational 狀態  
紅燈恆亮: 錯誤或 Stopped 狀態
```

### UART 除錯配置
```c
/* UART 腳位配置 */
UART_TX: P1.5
UART_RX: P1.4
波特率: 115200
資料位: 8
停止位: 1
```

## 🛠️ 建置和調試

### VS Code 中的操作
```bash
# 建置專案
Ctrl+Shift+P → "Tasks: Run Task" → "Build with DAVE"

# 或使用快捷鍵
Ctrl+Shift+B

# 調試專案  
F5 (會自動建置並燒錄)

# 清理專案
Ctrl+Shift+P → "Tasks: Run Task" → "Clean with DAVE"
```

### 命令列操作
```bash
# 建置
cd c:\prj\AI\CANOpen
# 透過 VS Code 任務執行 DAVE 建置

# 燒錄
# 會透過 J-Link 自動燒錄 (配置在 launch.json 中)
```

## 📋 檢查清單

### 環境確認
- [x] DAVE IDE 已安裝 (4.5.0.202105191637)
- [x] VS Code 已配置
- [x] J-Link 軟體已安裝 (假設)
- [ ] XMC4800 開發板已準備
- [ ] CAN 收發器電路已確認

### 專案設定確認
- [x] VS Code 工作區配置完成
- [x] 基礎專案結構建立
- [x] Git 設定檔案建立
- [ ] DAVE 專案建立
- [ ] CANopenNode 下載整合

### 硬體確認
- [ ] XMC4800 開發板 CAN 腳位確認
- [ ] CAN 收發器晶片確認 (TJA1050 或類似)
- [ ] CAN 匯流排終端電阻確認 (120Ω)
- [ ] 電源供應確認 (3.3V/5V)

## ⚠️ 重要注意事項

### 開發約束提醒
1. **絕對不准刪除程式碼** - 任何現有程式碼都必須保留和理解
2. **不准簡化程式碼** - 必須提供完整的實現
3. **遇到問題要分析程式碼** - 先理解再修改
4. **可以請示協助** - 詳細描述問題並尋求幫助

### 檔案命名規範
- C 檔案: 小寫底線分隔 (例: `can_xmc4800.c`)
- 標頭檔: 對應 C 檔案名稱 (例: `can_xmc4800.h`)
- 常數: 大寫底線分隔 (例: `CAN_BITRATE_500K`)
- 函數: 駝峰命名或模組前綴 (例: `CO_CANmodule_init`)

### Git 工作流程
```bash
# 定期提交變更
git add .
git commit -m "詳細描述變更內容"

# 更新 CANopenNode
git submodule update --remote

# 推送到遠端 (如有設定)
git push origin main
```

---

**下一步行動**: 
1. 開啟 DAVE IDE 建立 XMC4800_CANopen 專案
2. 配置必要的 DAVE Apps
3. 下載整合 CANopenNode 2.0
4. 開始 CAN 驅動層開發

**如有問題請立即提出**，我會依據專案規劃文件提供詳細的技術協助。